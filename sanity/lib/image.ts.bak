import createImageUrlBuilder from '@sanity/image-url'
import { SanityImageSource } from "@sanity/image-url/lib/types/types";

import { dataset, projectId } from '../env'

// Zabezpieczamy builder przed inicjalizacją z pustymi danymi.
const imageBuilder = (projectId && projectId !== 'no-project-id') 
  ? createImageUrlBuilder({ projectId, dataset }) 
  : null

export const urlFor = (source: SanityImageSource) => {
  // Jeśli builder nie istnieje (błąd konfigu), zwracamy obiekt mockowy, żeby nie wywalić renderowania
  if (!imageBuilder) {
    if (typeof window !== 'undefined') {
        console.warn('Sanity Image Builder not initialized due to missing config');
    }
    // Zwracamy łańcuch mockowy, który nie robi nic, ale nie rzuca błędu
    return {
      width: () => ({ url: () => '' }),
      height: () => ({ url: () => '' }),
      url: () => ''
    } as any;
  }
  return imageBuilder.image(source)
}